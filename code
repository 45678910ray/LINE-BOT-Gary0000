from flask import Flask, request, abort

from linebot import (
    LineBotApi, WebhookHandler
)
from linebot.exceptions import (
    InvalidSignatureError
)
from linebot.models import *

app = Flask(__name__)

# Channel Access Token
line_bot_api = LineBotApi('your line api')
# Channel Secret
handler = WebhookHandler('873c79ccb6e05a6e3fdb848dfecf1748')

# ç›£è½æ‰€æœ‰ä¾†è‡ª /callback çš„ Post Request
@app.route("/callback", methods=['POST'])

def callback():
    # get X-Line-Signature header value
    signature = request.headers['X-Line-Signature']
    # get request body as text
    body = request.get_data(as_text=True)
    app.logger.info("Request body: " + body)
    # handle webhook body
    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)
    return 'OK'
def Get_Cve_Description(CVE):
    CVE=CVE.split('-',1)[1]
    urlCVE="https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword="+CVE
    res=requests.get(urlCVE)
    sp=BeautifulSoup(res.text,'html.parser')
    Description = sp.find_all('td',{'valign':'top'})
    Description=Description[1].text.replace('\n\n','\n')
    Description="æè¿°:"+'\n'+Description
    #print(Description)
    return Description
def Get_Cve_NVD(CVE):
    urlNVD = 'https://nvd.nist.gov/vuln/detail/' + CVE
    res = requests.get(urlNVD)
    sp = BeautifulSoup(res.text, 'html.parser')

    Score = ""
    detal = sp.select(".severityDetail")
    if detal[0].text != ' N/A':
        Score += "CVSS 3.x:" + detal[0].text.replace('\n', '') + '\n' + Get_Cve_CVSSdetail3X(CVE) + "CVSS 2.0:" + detal[
            1].text + '\n' + Get_Cve_CVSSdetail20(CVE)
    else:
        Score += "CVSS 3.x:" + detal[0].text + '\n' + Get_Cve_CVSSdetail3X(CVE) + "CVSS 2.0:" + detal[
            1].text + '\n' + Get_Cve_CVSSdetail20(CVE)

    Weakness = ""
    Weakness = "å¼±é»æšèˆ‰:" + '\n'
    detal = sp.select("#vulnTechnicalDetailsDiv table.table-striped.table-condensed.table-bordered.detail-table a")
    for i in range(len(detal)):
        Weakness += detal[i].text + ":" + '\n' + detal[i]['href'] + '\n'
        
    allNVD = ""
    allNVD += Score + Weakness
    return allNVD
def Get_Cve_CVSSdetail20(CVE):
    urlNVD = "https://nvd.nist.gov/vuln/detail/" + CVE
    res = requests.get(urlNVD)
    sp = BeautifulSoup(res.text, 'html.parser')
    Vector = sp.select("#vulnCvssPanel span .tooltipCvss2NistMetrics")
    CVSSdetail = ""
    if len(Vector) == 0:
        return ("NO CVSS 2.0 IN NVD" + '\n')
    else:
        a = Vector[0].text.replace("(", "").replace(")", "").split('/')
        if a[0].split(":")[1] == "L":
            CVSSdetail += "Access Vector(æ”»æ“Šå‘é‡):" + "Local(åœ¨ä¸é€£æ¥ç¶²è·¯çš„ç‹€æ³ä¸‹é€²è¡Œæ”»æ“Š)" + '\n'
        elif a[0].split(":")[1] == "A":
            CVSSdetail += "Access Vector(æ”»æ“Šå‘é‡):" + "Adjacent Network(ç”±å—é™åˆ¶çš„ç¶²è·¯é€²è¡Œæ”»æ“Šï¼Œå¦‚å€åŸŸç¶²è·¯åŠè—èŠ½ç­‰)" + '\n'
        elif a[0].split(":")[1] == "N":
            CVSSdetail += "Access Vector(æ”»æ“Šå‘é‡):" + "Network(ç”±ç¶²éš›ç¶²è·¯ç¶²è·¯é€²è¡Œæ”»æ“Š)" + '\n'

        if a[1].split(":")[1] == "H":
            CVSSdetail += "Access Complexity(æ”»æ“Šè¤‡é›œåº¦):" + "HIGH" + '\n'
        elif a[1].split(":")[1] == "M":
            CVSSdetail += "Access Complexity(æ”»æ“Šè¤‡é›œåº¦):" + "Medium" + '\n'
        elif a[1].split(":")[1] == "L":
            CVSSdetail += "Access Complexity(æ”»æ“Šè¤‡é›œåº¦):" + "LOW" + '\n'

        if a[2].split(":")[1] == "M":
            CVSSdetail += "Authentication(èªè­‰æ–¹å¼):" + "Multiple(æ­¤æ¼æ´éœ€è¦æ”»æ“Šè€…é€²è¡Œå…©æ¬¡æˆ–å…©æ¬¡ä»¥ä¸Šçš„èº«ä»½é©—è­‰)" + '\n'
        elif a[2].split(":")[1] == "S":
            CVSSdetail += "Authentication(èªè­‰æ–¹å¼):" + "Single(è©²æ¼æ´è¦æ±‚æ”»æ“Šè€…ç™»éŒ„åˆ°ç³»çµ±ä¸­)" + '\n'
        elif a[2].split(":")[1] == "N":
            CVSSdetail += "Authentication(èªè­‰æ–¹å¼):" + "NONE" + '\n'

        if a[3].split(":")[1] == "N":
            CVSSdetail += "Confidentiality Impact(æ©Ÿå¯†æ€§å½±éŸ¿):" + "NONE" + '\n'
        elif a[3].split(":")[1] == "P":
            CVSSdetail += "Confidentiality Impact(æ©Ÿå¯†æ€§å½±éŸ¿):" + "Partial(æ”»æ“Šè€…å¯ä»¥å–å¾—æ©Ÿå¯†è³‡æ–™ï¼Œä½†ç„¡æ³•ä½¿ç”¨è©²è³‡æ–™)" + '\n'
        elif a[3].split(":")[1] == "C":
            CVSSdetail += "Confidentiality Impact(æ©Ÿå¯†æ€§å½±éŸ¿):" + "Complete(æ”»æ“Šè€…å¯ä»¥å–å¾—æ©Ÿå¯†è³‡æ–™ï¼Œä¸”å¯ä»¥ä½¿ç”¨è©²è³‡æ–™)" + '\n'

        if a[4].split(":")[1] == "N":
            CVSSdetail += "Integrity Impact(å®Œæ•´æ€§å½±éŸ¿):" + "NONE" + '\n'
        elif a[4].split(":")[1] == "P":
            CVSSdetail += "Integrity Impact(å®Œæ•´æ€§å½±éŸ¿):" + "Partial(æ”»æ“Šè€…æœ‰éƒ¨åˆ†æ¬Šé™ä»¥ç«„æ”¹æŸäº›è³‡æ–™ï¼Œå°å«æœ‰æ¼æ´ä¹‹å…ƒä»¶å½±éŸ¿è¼ƒå°)" + '\n'
        elif a[4].split(":")[1] == "C":
            CVSSdetail += "Integrity Impact(å®Œæ•´æ€§å½±éŸ¿):" + "Complete(æ”»æ“Šè€…æœ‰æ¬Šé™ç«„æ”¹æ‰€æœ‰è³‡æ–™ï¼Œå°å«æœ‰æ¼æ´ä¹‹å…ƒä»¶æœ‰åš´é‡å½±éŸ¿)" + '\n'

        if a[5].split(":")[1] == "N":
            CVSSdetail += "Availability Impact(å¯ç”¨æ€§å½±éŸ¿):" + "NONE" + '\n'
        elif a[5].split(":")[1] == "P":
            CVSSdetail += "Availability Impact(å¯ç”¨æ€§å½±éŸ¿):" + "Partial(å¯ç”¨æ€§å—åˆ°å½±éŸ¿ï¼Œå°è‡´æœå‹™æˆ–å…ƒä»¶ä»å¯è¢«éƒ¨åˆ†å–å¾—ï¼Œæˆ–æ˜¯æ™‚å¥½æ™‚å£)" + '\n'
        elif a[5].split(":")[1] == "C":
            CVSSdetail += "Availability Impact(å¯ç”¨æ€§å½±éŸ¿):" + "Complete(æ”»æ“Šè€…æœ‰æ¬Šé™ç«„æ”¹æ‰€æœ‰è³‡æ–™ï¼Œå°å«æœ‰æ¼æ´ä¹‹å…ƒä»¶æœ‰åš´é‡å½±éŸ¿)" + '\n'

        return CVSSdetail
def Get_Cve_CVSSdetail3X(CVE):
    urlNVD = "https://nvd.nist.gov/vuln/detail/" + CVE
    res = requests.get(urlNVD)
    sp = BeautifulSoup(res.text, 'html.parser')
    Vector = sp.select("#vulnCvssPanel span .tooltipCvss3NistMetrics")
    CVSSdetail = ""
    if len(Vector) == 0:
        return ("NO CVSS 3.X IN NVD" + '\n')
    else:
        a = Vector[0].text.split("/")
        if a[1].split(":")[1] == "N":
            CVSSdetail += "Attack Vector(æ”»æ“Šå‘é‡):" + "Network(ç”±ç¶²éš›ç¶²è·¯ç¶²è·¯é€²è¡Œæ”»æ“Š)" + '\n'
        elif a[1].split(":")[1] == "A":
            CVSSdetail += "Attack Vector(æ”»æ“Šå‘é‡):" + "Adjacent(ç”±å—é™åˆ¶çš„ç¶²è·¯é€²è¡Œæ”»æ“Šï¼Œå¦‚å€åŸŸç¶²è·¯åŠè—èŠ½ç­‰)" + '\n'
        elif a[1].split(":")[1] == "L":
            CVSSdetail += "Attack Vector(æ”»æ“Šå‘é‡):" + "Local(åœ¨ä¸é€£æ¥ç¶²è·¯çš„ç‹€æ³ä¸‹é€²è¡Œæ”»æ“Š)" + '\n'
        elif a[1].split(":")[1] == "P":
            CVSSdetail += "Attack Vector(æ”»æ“Šå‘é‡):" + "Physical(éœ€æ¥è§¸åˆ°å¯¦é«”æ©Ÿå™¨æ‰èƒ½é€²è¡Œæ”»æ“Š)" + '\n'

        if a[2].split(":")[1] == "L":
            CVSSdetail += "Attack Complexity(æ”»æ“Šè¤‡é›œåº¦):" + "LOW" + '\n'
        elif a[2].split(":")[1] == "H":
            CVSSdetail += "Attack Complexity(æ”»æ“Šè¤‡é›œåº¦):" + "HIGH" + '\n'

        if a[3].split(":")[1] == "N":
            CVSSdetail += "Privileges Required(æ˜¯å¦éœ€è¦ææ¬Š):" + "NONE" + '\n'
        elif a[3].split(":")[1] == "L":
            CVSSdetail += "Privileges Required(æ˜¯å¦éœ€è¦ææ¬Š):" + "LOW" + '\n'
        elif a[3].split(":")[1] == "H":
            CVSSdetail += "Privileges Required(æ˜¯å¦éœ€è¦ææ¬Š):" + "HIGH" + '\n'

        if a[4].split(":")[1] == "N":
            CVSSdetail += "User Interaction(æ˜¯å¦éœ€è¦ä½¿ç”¨è€…æ“ä½œ):" + "NONE" + '\n'
        elif a[4].split(":")[1] == "R":
            CVSSdetail += "User Interaction(æ˜¯å¦éœ€è¦ä½¿ç”¨è€…æ“ä½œ):" + "Required" + '\n'

        if a[5].split(":")[1] == "U":
            CVSSdetail += "Scope(å½±éŸ¿ç¯„åœ):" + "Unchanged(åƒ…å½±éŸ¿å«æœ‰æ¼æ´çš„å…ƒä»¶æœ¬èº«)" + '\n'
        elif a[5].split(":")[1] == "C":
            CVSSdetail += "Scope(å½±éŸ¿ç¯„åœ):" + "Changed(æœƒå½±éŸ¿åˆ°å«æœ‰æ¼æ´çš„å…ƒä»¶ä»¥å¤–çš„å…ƒä»¶)" + '\n'

        if a[6].split(":")[1] == "N":
            CVSSdetail += "Confidentiality(æ©Ÿå¯†æ€§å½±éŸ¿):" + "NONE" + '\n'
        elif a[6].split(":")[1] == "L":
            CVSSdetail += "Confidentiality(æ©Ÿå¯†æ€§å½±éŸ¿):" + "LOW(æ”»æ“Šè€…å¯ä»¥å–å¾—æ©Ÿå¯†è³‡æ–™ï¼Œä½†ç„¡æ³•ä½¿ç”¨è©²è³‡æ–™)" + '\n'
        elif a[6].split(":")[1] == "H":
            CVSSdetail += "Confidentiality(æ©Ÿå¯†æ€§å½±éŸ¿):" + "HIGH(æ”»æ“Šè€…å¯ä»¥å–å¾—æ©Ÿå¯†è³‡æ–™ï¼Œä¸”å¯ä»¥ä½¿ç”¨è©²è³‡æ–™)" + '\n'

        if a[7].split(":")[1] == "N":
            CVSSdetail += "Integrity(å®Œæ•´æ€§å½±éŸ¿):" + "NONE" + '\n'
        elif a[7].split(":")[1] == "L":
            CVSSdetail += "Integrity(å®Œæ•´æ€§å½±éŸ¿):" + "LOW(æ”»æ“Šè€…æœ‰éƒ¨åˆ†æ¬Šé™ä»¥ç«„æ”¹æŸäº›è³‡æ–™ï¼Œå°å«æœ‰æ¼æ´ä¹‹å…ƒä»¶å½±éŸ¿è¼ƒå°)" + '\n'
        elif a[7].split(":")[1] == "H":
            CVSSdetail += "Integrity(å®Œæ•´æ€§å½±éŸ¿):" + "HIGH(æ”»æ“Šè€…æœ‰æ¬Šé™ç«„æ”¹æ‰€æœ‰è³‡æ–™ï¼Œå°å«æœ‰æ¼æ´ä¹‹å…ƒä»¶æœ‰åš´é‡å½±éŸ¿)" + '\n'

        if a[8].split(":")[1] == "N":
            CVSSdetail += "Availability(å¯ç”¨æ€§å½±éŸ¿):" + "NONE" + '\n'
        elif a[8].split(":")[1] == "L":
            CVSSdetail += "Availability(å¯ç”¨æ€§å½±éŸ¿):" + "LOW(å¯ç”¨æ€§å—åˆ°å½±éŸ¿ï¼Œå°è‡´æœå‹™æˆ–å…ƒä»¶ä»å¯è¢«éƒ¨åˆ†å–å¾—ï¼Œæˆ–æ˜¯æ™‚å¥½æ™‚å£)" + '\n'
        elif a[8].split(":")[1] == "H":
            CVSSdetail += "Availability(å¯ç”¨æ€§å½±éŸ¿):" + "HIGH(æ”»æ“Šè€…æœ‰æ¬Šé™ç«„æ”¹æ‰€æœ‰è³‡æ–™ï¼Œå°å«æœ‰æ¼æ´ä¹‹å…ƒä»¶æœ‰åš´é‡å½±éŸ¿)" + '\n'

        return CVSSdetail
def stackoverflow(CVE):
    new_cve=CVE.split('-',1)[1]
    urlstackoverflow="https://stackoverflow.com/search?q=CVE+"+new_cve
    res=requests.get(urlstackoverflow)
    sp=BeautifulSoup(res.text,'html.parser')
    aaa=sp.select('.result-link a')
    stackoverflow=""
    stackoverflow+="stackoverflow:"+'\n'
    for i in range(len(aaa)):
        stackoverflow+="https://stackoverflow.com"+aaa[i]['href']+'\n'
    return stackoverflow
def Get_Cve_NEW(CVE):
    urlNVD='https://cve.mitre.org/cgi-bin/cvename.cgi?name='+CVE
    res=requests.get(urlNVD)
    sp=BeautifulSoup(res.text,'html.parser')
    detal=sp.find_all("a",string=re.compile("^URL:http://www.securityfocus.com"))
    SecurityFocus=""
    SecurityFocus="SecurityFocus:"+'\n'
    if len(detal)!=0:
        SecurityFocus+=detal[0].text.split(":", 1)[1]+'\n'
        return SecurityFocus
    else :
        return SecurityFocus
def Get_Cve_EX(CVE):
    urlNVD='https://cve.mitre.org/cgi-bin/cvename.cgi?name='+CVE
    res=requests.get(urlNVD)
    sp=BeautifulSoup(res.text,'html.parser')
    detal=sp.find_all("a",string=re.compile("^URL:http://www.exploit-db.com/exploits/"))
    exploits=""
    exploits="exploits:"+'\n'
    if len(detal)!=0:
        exploits+=detal[0].text.split(":", 1)[1]+'\n'
        return exploits
    else :
        return exploits
def Get_Cve_packetstormsecurity(CVE):
    urlpacketstormsecurity="https://packetstormsecurity.com/search/?q="+CVE
    res=requests.get(urlpacketstormsecurity)
    sp=BeautifulSoup(res.text,'html.parser')
    Description = sp.select("dt a")
    packetstormsecuritytest=""
    packetstormsecuritytest="Packetstormsecurity:"+'\n'
    if len(Description)!=0:
        packetstormsecuritytest+=urlpacketstormsecurity
        return packetstormsecuritytest
    else :
        packetstormsecuritytest = "Packetstormsecurity:NONE!" + '\n'
        return packetstormsecuritytest

# è™•ç†è¨Šæ¯
@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    #message = TextSendMessage(text='Hello, world')
    #event.message.text=æ¥æ”¶åˆ°çš„è¨Šæ¯
    first=event.message.text
    if first.split(":")[0]=="ip":
        SHODAN_API_KEY = "30H2ZRCWIvMzn7SDfY2yU9odqGtRjZ0C"  # è¼¸å…¥è‡ªå·±çš„APIKEY
        api = shodan.Shodan(SHODAN_API_KEY)
        dnsResolve = 'https://api.shodan.io/dns/resolve?hostnames=' + '&key=' + SHODAN_API_KEY
        a = ""
        b = ""
        c = ""
        d = ""
        d += "æ‚¨é‚„æœ‰ä»¥ä¸‹CVEæ¼æ´ï¼Œç”±æ–¼å­—æ•¸é™åˆ¶å•é¡Œï¼Œè«‹ç§»å‹•è‡³å®Œæ•´ç‰ˆç”¢å“æŸ¥çœ‹è©³ç´°è³‡æ–™:" + '\n'
        try:
            resolved = requests.get(dnsResolve)
            hostIP = first.split(":")[1]
            host = api.host(hostIP)
            # print ('\033[31m'+ "IP: %s" % host['ip_str'] +'\033[0m')
            a += "IP:" + str(hostIP) + '\n'
            a += "Organization: " + str(host.get('org', 'n/a')) + '\n'
            a += "Operating System: " + str(host.get('os', 'n/a')) + '\n'
            a += "Country:" + str(host.get('country_name', 'n/a'))
            if str(host.get('country_name', 'n/a')) == "Taiwan":
                a += "ğŸ‡¹ğŸ‡¼" + '\n'
            elif str(host.get('country_name', 'n/a')) == "United States":
                a += "ğŸ‡ºğŸ‡¸" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Japan":
                a += "ğŸ‡¯ğŸ‡µ" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Canada":
                a += "ğŸ‡¨ğŸ‡¦" + '\n'
            elif str(host.get('country_name', 'n/a')) == "South Korea":
                a += "ğŸ‡°ğŸ‡·" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Russia":
                a += "ğŸ‡·ğŸ‡º" + '\n'
            elif str(host.get('country_name', 'n/a')) == "United Kingdom":
                a += "ğŸ‡¬ğŸ‡§" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Brazil":
                a += "ğŸ‡§ğŸ‡·" + '\n'
            elif str(host.get('country_name', 'n/a')) == "South Africa":
                a += "ğŸ‡¿ğŸ‡¦" + '\n'
            elif str(host.get('country_name', 'n/a')) == "China":
                a += "ğŸ‡¨ğŸ‡³" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Spain":
                a += "ğŸ‡ªğŸ‡¸" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Italy":
                a += "ğŸ‡®ğŸ‡¹" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Germany":
                a += "ğŸ‡©ğŸ‡ª" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Finland":
                a += "ğŸ‡«ğŸ‡®" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Norway":
                a += "ğŸ‡³ğŸ‡´" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Hong Kong":
                a += "ğŸ‡­ğŸ‡°" + '\n'
            elif str(host.get('country_name', 'n/a')) == "India":
                a += "ğŸ‡®ğŸ‡³" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Singapore":
                a += "ğŸ‡¸ğŸ‡¬" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Indonesia":
                a += "ğŸ‡®ğŸ‡©" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Cambodia":
                a += "ğŸ‡°ğŸ‡­" + '\n'
            elif str(host.get('country_name', 'n/a')) == "France":
                a += "ğŸ‡«ğŸ‡·" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Ireland":
                a += "ğŸ‡®ğŸ‡ª" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Switzerland":
                a += "ğŸ‡¨ğŸ‡­" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Greece":
                a += "ğŸ‡¬ğŸ‡·" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Thailand":
                a += "ğŸ‡¹ğŸ‡­" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Vietnam":
                a += "ğŸ‡»ğŸ‡³" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Turkey":
                a += "ğŸ‡¹ğŸ‡·" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Australia":
                a += "ğŸ‡¦ğŸ‡º" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Netherlands":
                a += "ğŸ‡³ğŸ‡±" + '\n'
            elif str(host.get('country_name', 'n/a')) == "Chile":
                a += "ğŸ‡¨ğŸ‡±" + '\n'
            i = 0
            a += "--------------------------------" + '\n'
            for item in host['vulns']:
                i += 1
                if i < 3:
                    CVE = item.replace('!', '')
                    CVE = str(CVE)

                    a += CVE + ':' + '\n'
                    a += Get_Cve_Description(CVE) + Get_Cve_NVD(CVE) + stackoverflow(CVE) + Get_Cve_NEW(
                        CVE) + Get_Cve_EX(CVE) + Get_Cve_packetstormsecurity(CVE)
                    a += "--------------------------------" + '\n'
                elif i >= 3 and i < 5:
                    CVE = item.replace('!', '')
                    CVE = str(CVE)

                    b += CVE + ':' + '\n'
                    b += Get_Cve_Description(CVE) + Get_Cve_NVD(CVE) + stackoverflow(CVE) + Get_Cve_NEW(
                        CVE) + Get_Cve_EX(CVE) + Get_Cve_packetstormsecurity(CVE)
                    b += "--------------------------------" + '\n'
                elif i >= 5 and i < 7:
                    CVE = item.replace('!', '')
                    CVE = str(CVE)

                    c += CVE + ':' + '\n'
                    c += Get_Cve_Description(CVE) + Get_Cve_NVD(CVE) + stackoverflow(CVE) + Get_Cve_NEW(
                        CVE) + Get_Cve_EX(CVE) + Get_Cve_packetstormsecurity(CVE)
                    c += "--------------------------------" + '\n'+""
                elif i >= 7:
                    CVE = item.replace('!', '')
                    CVE = str(CVE)
                    d += CVE + '\n'
        except:
            'An error occured'
            if a == "":
                a = "è¼¸å…¥éŒ¯èª¤orä¸ç¬¦åˆæ ¼å¼!"
                reply_arr = []
                reply_arr.append(TextSendMessage(a))
                line_bot_api.reply_message(event.reply_token, reply_arr)
        reply_arr = []
        reply_arr.append(TextSendMessage(a))
        if i >= 3:
            reply_arr.append(TextSendMessage(b))
        if i >= 5:
            reply_arr.append(TextSendMessage(c))
        if i >= 7:
            reply_arr.append(TextSendMessage(d))
        line_bot_api.reply_message(event.reply_token, reply_arr)
    elif first.split(":")[0]=="cve":
        try:
            ccc=first.split(":")[1]
            CVElist=[]
            a=""
            b=""
            c=""
            d="æ‚¨é‚„æœ‰æœå°‹ä»¥ä¸‹CVEæ¼æ´ï¼Œç”±æ–¼å­—æ•¸é™åˆ¶å•é¡Œï¼Œè«‹ç§»å‹•è‡³å®Œæ•´ç‰ˆç”¢å“æŸ¥çœ‹è©³ç´°è³‡æ–™:" + '\n'
            for i in range(len(ccc.split(" "))):
                CVElist.append(ccc.split(" ")[i])
            for i in range(len(CVElist)):
                if i < 3:
                    CVE = str(CVElist[i])
                    a += CVE + ':' + '\n'
                    a += Get_Cve_Description(CVE) + Get_Cve_NVD(CVE) + stackoverflow(CVE) + Get_Cve_NEW(
                        CVE) + Get_Cve_EX(CVE) + Get_Cve_packetstormsecurity(CVE)
                    a += "--------------------------------" + '\n'
                elif i >= 3 and i < 5:
                    CVE = str(CVElist[i])
                    b += CVE + ':' + '\n'
                    b += Get_Cve_Description(CVE) + Get_Cve_NVD(CVE) + stackoverflow(CVE) + Get_Cve_NEW(
                        CVE) + Get_Cve_EX(CVE) + Get_Cve_packetstormsecurity(CVE)
                    b += "--------------------------------" + '\n'
                elif i >= 5 and i < 7:
                    CVE = str(CVElist[i])
                    c += CVE + ':' + '\n'
                    c += Get_Cve_Description(CVE) + Get_Cve_NVD(CVE) + stackoverflow(CVE) + Get_Cve_NEW(
                        CVE) + Get_Cve_EX(CVE) + Get_Cve_packetstormsecurity(CVE)
                    c += "--------------------------------" + '\n'
                elif i >= 7:
                    CVE = str(CVElist[i])
                    d += CVE + '\n'
            reply_arr = []
            reply_arr.append(TextSendMessage(a))
            if i >= 3:
                reply_arr.append(TextSendMessage(b))
            if i >= 5:
                reply_arr.append(TextSendMessage(c))
            if i >= 7:
                reply_arr.append(TextSendMessage(d))
            line_bot_api.reply_message(event.reply_token, reply_arr)
        except:
            a = "è¼¸å…¥éŒ¯èª¤orä¸ç¬¦åˆæ ¼å¼!"
            reply_arr = []
            reply_arr.append(TextSendMessage(a))
            line_bot_api.reply_message(event.reply_token, reply_arr)
    else:
        a = "è¼¸å…¥éŒ¯èª¤orä¸ç¬¦åˆæ ¼å¼!"
        reply_arr = []
        reply_arr.append(TextSendMessage(a))
        line_bot_api.reply_message(event.reply_token, reply_arr)
    #message = TextSendMessage(text=a)
    #line_bot_api.reply_message(event.reply_token, message)

import os
import requests
import shodan
import re
import socket
import nmap
from bs4 import BeautifulSoup
if __name__ == "__main__":
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port)

